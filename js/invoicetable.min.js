
function setamount1(value){
  var itemname = $('#itemdetailid'+value).val();

  if(itemname===""){
    var param1="Please Select Item Name";
            app.toast(param1, {
              actionTitle: 'warning',
              // actionUrl: 'something',
              actionColor: 'warning'
            });
  }
  else{

      var qty = parseInt($('#qty'+value).val());
      fetchspecialshippingqty(itemname,qty,value);
      setamount(value);
      // $.ajax({
      //     type: "POST",
      //     url:"../src/fetchspecialshippingqty.php",
      //     data:{
      //       itemid:itemname,
      //       itemqty:qty
      //     },
      //     success: function(msg) {
      //        var response = JSON.parse(msg);
      //        // alert(response['BillQty']);
      //        if(response['BillQty']==0){
      //          response['BillQty'] = qty;
      //        }
      //        $("#billingqty"+value).val(response['BillQty']);
      //
      //     }
      // });
    // }
  }
}
function fetchspecialshippingqty(itemid,itemqty,value){

  var itemunits = parseInt($("#itemunits"+value).val());
  // alert("Items Unit"+itemunits);
  var unitsubpackingqty =parseInt($("#unitsubpackingqty"+value).val());
  var unitpackingqty =parseInt($("#unitpackingqty"+value).val());
  var hiddenqtyonhand = parseInt($('#hiddenqtyonhand'+value).val());
  var totalavlqty = hiddenqtyonhand*unitpackingqty;
  var unitremainqty = parseInt($("#unitremainqty"+value).val());
  var valuesetamount = 1;
  var remainperunit = 0;
  switch(itemunits) {
  case 1:
    valuesetamount = 1;
    remainperunit=unitremainqty;
    break;
  case 2:
    valuesetamount = valuesetamount*unitsubpackingqty;
    remainperunit  = unitremainqty/unitsubpackingqty;

    break;
  case 3:
    valuesetamount = valuesetamount*unitpackingqty;
    remainperunit  = unitremainqty/unitpackingqty;

    break;
  default:
    valuesetamount = 1;
  }
  var formid = $("#hiddenformid").val();
  var hiddenformtype = $("#hiddenformtype").val();
  if(formid==="1"){
    if(hiddenformtype==="U"){
      if(hiddenqtyonhand==0){
        // $('#qty'+value).val(qty);
      }
      // else{
      //   qty=hiddenqtyonhand;
      //   $('#qty'+value).val(qty);
      // }
    }
    else {
  if(remainperunit<=itemqty){
    itemqty=remainperunit;
    // alert(itemqty);
    $('#qty'+value).val(remainperunit);
  }
}

}

  $.ajax({
      type: "POST",
      url:"../src/fetchspecialshippingqty.php",
      data:{

        itemid:itemid,
        itemqty:itemqty
      },
      success: function(msg) {
        // alert(msg);
         var response = JSON.parse(msg);

         if(response['BillQty']==0){
           response['BillQty'] = itemqty;
         }

         $("#billingqty"+value).val(response['BillQty']);
         setamount(value);
      }
  });
}
function setamount(value){

  var itemunits = parseInt($("#itemunits"+value).val());
  var unitsubpackingqty = parseInt($("#unitsubpackingqty"+value).val());
  var unitpackingqty =parseInt($("#unitpackingqty"+value).val());
  var hiddenqtyonhand = parseInt($('#hiddenqtyonhand'+value).val());
  var totalavlqty = hiddenqtyonhand*unitpackingqty;
  var unitremainqty = parseInt($("#unitremainqty"+value).val());
  var valuesetamount = 1;
  var remainperunit = 0;
  switch(itemunits) {
  case 1:
    valuesetamount = 1;
    remainperunit=unitremainqty;
    break;
  case 2:
    valuesetamount = valuesetamount*unitsubpackingqty;
      remainperunit  = unitremainqty/unitsubpackingqty;
    break;
  case 3:
    valuesetamount = valuesetamount*unitpackingqty;
    remainperunit  = unitremainqty/unitpackingqty;
    break;
  default:
    valuesetamount = 1;
  }
  // alert("Set Amount"+remainperunit);

  var qty = parseInt($('#qty'+value).val());
  var billingqty = parseFloat($('#billingqty'+value).val());
  if(billingqty===0){
    billingqty =qty;
  }

  var formid = $("#hiddenformid").val();
  var hiddenformtype = $("#hiddenformtype").val();
  var itemdiscount = parseFloat($("#itemdiscount"+value).val());

  if(isNaN(itemdiscount) || itemdiscount<=0){
    itemdiscount =0.0000000000000001;
  }

  if(formid==="1"){
    if(hiddenformtype==="U"){
      if(hiddenqtyonhand==0){
        $('#qty'+value).val(qty);
      }
      // else{
      //   qty=hiddenqtyonhand;
      //   $('#qty'+value).val(qty);
      // }
    }
    else {
      // var itemunits = $("#itemunits"+value).val();
      // var unitpackingqty =parseInt($("#unitpackingqty"+value).val());
      // var unitremainqty = parseInt($("#unitremainqty"+value).val());

      if(remainperunit<=qty){

        qty=remainperunit;
         // alert("IF Qty"+qty);
        $('#qty'+value).val(qty);
      }
    }

  }
  var rate = $('#rate'+value).val();
  var amount = billingqty * rate * valuesetamount;
  amount = amount - (amount * (itemdiscount/100));

  $('#amount'+value).val(amount.toFixed(2));
  settaxintable(value);
  calculation();

}
function setdiscount(){
  var subtotal = 0;
  var total = 0;
  var i = 0;
  $('#DyanmicTable tbody td:nth-child(1)').each(function () {
        var value = parseInt($(this).html());
        var amount = $('#amount'+value).val();
        subtotal = subtotal + parseFloat(amount);
  });

  $('#gsttaxtable tr td:nth-child(1)').each(function () {
        var value = $(this).html();
        var arr = value.split("@");
        var arr1 = arr[1].split("%");

        if(i==0){
          var cgst = $("#CGST"+(arr1[0]*1000)).val();

          var sgst = $("#SGST"+(arr1[0]*1000)).val();
          total = total + parseFloat(cgst) + parseFloat(sgst);
          i=1;
        }
        else
        {
          i=0;
        }
  });
  total = total + subtotal;

  var discount = parseFloat($("#discount").val());
  if((discount>0) && (discount<100) ){
    var answer = total * (discount/100);
    var ansprocess =  total-answer;
    $('#finaltotal').text(ansprocess.toFixed(2));
  }
  else {
    $("#discount").val("0.0");
  }

}
function connectitemname(value){
      $.ajax({
          type: "POST",
          url: "../src/fetch_itemnames.php",
          success: function(msg) {
            var itemspan='';
            itemspan+='<select class="form-control" data-provide="selectpicker" data-live-search="true"  title="Choose a items" id="itemname'+(value)+'" onchange="getiteminform('+value+')">';
            itemspan+=msg;
            itemspan+='<option data-icon="fa fa-edit" style="font-weight: bold;  padding: 5px;color: #797878;border: 2px solid #71bd71;"  value="#ai" >Add Items</option>';
            itemspan+='<option value=""></option>';
            itemspan+='</select>';

            $("#itemspan"+value).html(itemspan);
          }
      });
}
function connectitemunit(value){
      $.ajax({
          type: "POST",
          url: "../src/fetch_itemunitforall.php",
          success: function(msg) {
            var itemspan='';
            itemspan+='<select class="form-control" data-provide="selectpicker" data-live-search="true"  title="Choose a Item Unit" id="itemunits'+(value)+'" onchange="setitemunitinform('+value+')" >';
            itemspan+=msg;
            // itemspan+='<option data-icon="fa fa-edit" style="font-weight: bold;  padding: 5px;color: #797878;border: 2px solid #71bd71;"  value="#ai" >Add Items</option>';
            // itemspan+='<option value=""></option>';
            itemspan+='</select>';

            $("#iteminvdesc"+value).html(itemspan);

          }
      });
}
function gettaxvaluefromtaxid(param,value){
  $.ajax({
      type: "POST",
      url: "../src/fetchtaxvaluefromtaxid.php",
      data:{
        taxid:param
      },
      success: function(msg) {
         var response = JSON.parse(msg);
          $('#tax'+value).val(response['TaxPercent']).trigger('change');
      }
  });
}
function setitemunitinform(param){
  var itemunitid = $("#itemunits"+param).val();
  var itemnameid = $("#itemdetailid"+param).val();
  $.ajax({
      type: "POST",
      url: "../src/fetchitemunitinformation.php",
      data:{
        itemunitid:itemunitid,
        itemnameid:itemnameid
      },
      success: function(msg) {
       // alert(msg);
        var response = JSON.parse(msg);

        if(response['SubPacking']==0){
          response['SubPacking']=1;
        }
        if(response['PackingQty']==0){
          response['PackingQty']=1;
        }
        $("#unitsubpackingqty"+param).val(response['SubPacking']);
        $("#unitpackingqty"+param).val(response['PackingQty']);
        // $("#qty"+param).val(1);
        var itemqty = $("#qty"+param).val();
        fetchspecialshippingqty(itemnameid,itemqty,param);
        // setamountforunit(param);
      }
  });
}
function getiteminform(param){

  var itemname = $("#itemname"+param).val();
  var itemdetailid =$("#itemdetailid"+param).val();

  if(itemname==="#ai"){
    $('#hiddenitemnameid').val(param);

    $('#ItemModal').modal('show');
    $("#itemname"+param).val("");

     $("#NewItemName").val("");
  }
  else{

        // $("#itemunits"+param).val(1);

        // kunal first
        // $("#itemunits"+param).val("1").trigger("change");
        // $("#unitsubpackingqty"+param).val(1);
        // $("#unitpackingqty"+param).val(1);
    $.ajax({
        type: "POST",
        url: "../src/fetchitemnameinfobyid.php",
        data:{
          itemname:parseInt(itemname)
        },
        success: function(msg) {

          var response = JSON.parse(msg);
          var count = Object.keys(response).length;
          if(count>0){

           $('#desc'+param).val(response['Description']);
           $('#hsn'+param).val(response['HSN']);
           // $('#qty'+param).val(response['Quantity']);
           var qty = parseInt($('#qty'+param).val());
           if(qty===""){
           $('#qty'+param).val(1);
           }
           else{
              $('#qty'+param).val(qty);
           }
           $('#rate'+param).val(response['price']);
           $('#amount'+param).val(1*response['price']);
           $('#itemdetailid'+param).val(response['itemDetailId']);
           $('#hiddenqtyonhand'+param).val(response['Quantity']);
           $('#hiddenlowstockalert'+param).val(response['ReorderLabel']);
           $('#qty'+param).attr('title',"Quantity in hand "+response['Quantity']);


           $("#itemunits"+param).val("1").trigger("change");

           $("#unitsubpackingqty"+param).val(response['SubPacking']);
           $("#unitpackingqty"+param).val(response['PackingQty']);
           $("#unitremainqty"+param).val(response['totalqty']);


           gettaxvaluefromtaxid(response['TaxId'],param);
          }




        }
    });
  }

}
function additemsinfo()
{
    var itemname  = $('#itemname').val();
    var itemquantity  = $('#itemquantity').val();
    var value = $("#hiddenitemnameid").val();
    if(itemname === ""){
        $('#itemname').focus();
    }
    else if (itemquantity === "")
    {
       $('#itemquantity').focus();

    }
    else{
      $.ajax({
            type: "POST",
            url: "../src/AddNewitem.php",
            data:({itemname:itemname,itemquantity:itemquantity}),
            dataType:'json',
            success: function(response) {
              $('#ItemModal').modal('hide');
              connectitemname(value);
              clear_items();

            }
        });
    }
}

function connectitemtax(value){
      $.ajax({
          type: "POST",
          url: "../src/fetch_itemtax.php",
          success: function(msg) {
            var itemspan='';
            itemspan+='<select class="form-control" data-provide="selectpicker" data-live-search="true"  title="Choose a TAX" id="tax'+(value)+'" onchange="settaxintable('+value+')">';
            itemspan+=msg;
            itemspan+='<option data-icon="fa fa-edit" style="font-weight: bold;  padding: 5px;color: #797878;border: 2px solid #71bd71;"  value="#at" >Add Tax</option>';
            itemspan+='<option value=""></option>';
            itemspan+='</select>';

            $("#taxspan"+value).html(itemspan);
          }
      });
}
function calculation(){
  var subtotal = 0;
  var total = 0;
  var i = 0;
  $('#DyanmicTable tbody td:nth-child(1)').each(function () {
        var value = parseInt($(this).html());
        var amount = $('#amount'+value).val();
        subtotal = subtotal + parseFloat(amount);
  });

  $('#gsttaxtable tr td:nth-child(1)').each(function () {
        var value = $(this).html();
        var arr = value.split("@");
        var arr1 = arr[1].split("%");

        if(i==0){

          var cgst = $("#CGST"+(arr1[0]*1000)).val();

          var sgst = $("#SGST"+(arr1[0]*1000)).val();
          total = total + parseFloat(cgst) + parseFloat(sgst);
          i=1;
        }
        else
        {
          i=0;
        }
  });
  total = total + subtotal;
  if(total>0){
  $("#discount").val("0.00");
  $("#hidediscount").show();
  }
  else{
      $("#discount").val("0.00");
    $("#hidediscount").hide();
  }

  $('#subtotal').text(subtotal.toFixed(2));
  $('#total').text(total.toFixed(2));
  $('#finaltotal').text(total.toFixed(2));
  $('#balancedue').text(total.toFixed(2));
}
function getFormattedDate(date) {
    let year = date.getFullYear();
    let month = (1 + date.getMonth()).toString().padStart(2, '0');
    let day = date.getDate().toString().padStart(2, '0');

    return month + '/' + day + '/' + year;
}
function editappenditemtable(param){

  $.ajax({
      type: "GET",
      async:false,
      // async: true,
      // async:true ,
      // cache:true,
      // async: false,
      url: "../src/fetchappenditemtable.php",
      data:({
        transactionno:param
      }),
      success: function(msg) {
        var rows = 0;
        var n =0;
        var t;
        var response = JSON.parse(msg);

        $("#customername").val(response[0]['PersonId']).trigger('change');

        var date1 = new Date(response[0]['DateCreated']);
        var date2 = new Date(response[0]['DueDate']);
        var timeDiff = Math.abs(date2.getTime() - date1.getTime());
        var diffDays = Math.ceil(timeDiff / (1000 * 3600 * 24));

        $("#remark").val(response[0]['remarks']);
        $("#terms").val(diffDays).trigger('change');
        var count = Object.keys(response).length;
        for(n=0;n<count;n++){
          rows = n;
          t +='<tr id=rem'+(rows+1)+'><td> '+(rows+1)+'</td>';
          t +='<td>';
          t +='<input type="hidden" id="itemdetailid'+(rows+1)+'">';
          t +='<span id=itemspan'+(rows+1)+'></span>';
          t +='</td>';
          t +='<td>';
          t +='  <input type="text" class="form-control" placeholder="HSN/SAC " id="hsn'+(rows+1)+'" readonly>';
          t +='</td>';
          t +='<td>';
          t +='<span id=iteminvdesc'+(rows+1)+'></span>';
          t +='<input type="hidden" id="unitsubpackingqty'+(rows+1)+'"/>';
          t +='<input type="hidden" id="unitpackingqty'+(rows+1)+'"/>';
          t +='<input type="hidden" id="unitremainqty'+(rows+1)+'"/>';
          // t +='<input type="hidden" id="hiddentax'+(rows+1)+'"/>';
          // t +='  <input type="text" class="form-control" placeholder="DESCRIPTION " id="desc'+(rows+1)+'">';
          t +='</td>';
          t +='<td>';
          t +='<div class="row">';
          t +='<div class="col-sm-12">';
          t +='<div class="form-group">';
          t +='<input type="text" class="form-control" value="1" data-provide="tooltip" data-placement="top"  title="Quantity in hand 0" id="qty'+(rows+1)+'" onchange="setamount1('+(rows+1)+')" onkeypress="return isNumberInt(event);">';
          t +='<input type="hidden" id="hiddenqtyonhand'+(rows+1)+'">';
          t +='<input type="hidden" id="hiddenlowstockalert'+(rows+1)+'">';
          t +='</div>';
          t +='</div>';
          t +='</div>';
          t +='</td>';
          t +='<td>';
          t +='<div class="row">';
          t +='<div class="col-sm-12">';
          t +='<div class="form-group">';
          t +='<input type="text" class="form-control" value="1" data-provide="tooltip" data-placement="top"  title="Billing Quantity" id="billingqty'+(rows+1)+'" readonly/>';
          // t +='<input type="hidden" id="hiddenqtyonhand'+(rows+1)+'">';
          // t +='<input type="hidden" id="hiddenlowstockalert'+(rows+1)+'">';
          t +='</div>';
          t +='</div>';
          t +='</div>';
          t +='</td>';
          t +='<td>';
          t +='  <input type="text" class="form-control" value="0.00" placeholder="RATE" id="rate'+(rows+1)+'" onchange="setamount('+(rows+1)+')" onkeypress="return isNumberKey(event);">';
          t +='</td>';
          t +='<td>';
          t +='  <input type="text" class="form-control" value="0.00" placeholder="Discount" id="itemdiscount'+(rows+1)+'" onkeypress="return isNumberKey(event);" onchange="setamount('+(rows+1)+')" >';
          t +='</td>';
          t +='<td>';
          t +='  <input type="text" class="form-control" value="0.00" placeholder="AMOUNT" id="amount'+(rows+1)+'" readonly>';
          t +='</td>';

          t +='<td>';
          t +='<input type="hidden" id="hiddentax'+(rows+1)+'"/>';
          t +='<span id=taxspan'+(rows+1)+'></span>';
          t +='</td>';
          t += '<td name="buttons" class="text-center"><div class="btn-group ">';
          t += '<button id="bElim" type="button" class="btn btn-square btn-outline btn-pure btn-danger" onclick="rowElim(this,'+(rows+1)+');">';
          t += '<i class="ti-close"></i>';
          t += '</button>';
          t += '</div></td></tr>';

          connectitemname(rows+1);
          connectitemtax(rows+1);
          connectitemunit(rows+1);
            // $("#itemname"+(newval+1)).val(parseInt(response[i]['itemid']));

        }
        $('#DyanmicTable tbody').append("" + t + "");
        // $tab_en_edic.find("tbody").append("" + t + "");
        // setTimeout(function()
        // {

        // }, 2000);

       setTimeout(function()
       {
         var newval = 0;
         for(var j=0;j<count;j++){
          newval = j+1;


          $("#itemname"+newval).val(response[j]['itemid']).trigger('change');
          $("#hsn"+newval).val(response[j]['hsn']);

         }
       },500);
       // setTimeout(function()
       // {
       //   var newval = 0;
       //   for(var j=0;j<count;j++){
       //    newval = j+1;
       //
       //
       //    $("#itemunits"+newval).val(response[j]['itemunitval']).trigger('change');
       //   }
       // },500);



       setTimeout(function()
       {
         var newval = 0;
         for(var j=0;j<count;j++){
          newval = j+1;
          var discountval = response[j]['itemdiscount'];

          if(discountval==0){
            discountval = 0.0;

          }
            $("#itemunits"+newval).val(response[j]['itemunitval']).trigger('change');
          $("#tax"+newval).val(response[j]['TaxPercent']).trigger('change');
          $("#qty"+newval).val(response[j]['qty']).trigger('change');
          $("#rate"+newval).val(response[j]['rate']).trigger('change');
          $("#amount"+newval).val(response[j]['rate']*response[j]['qty']);
            $("#itemdiscount"+newval).val(discountval).trigger('change');
          // $("#discount").val(response[j]['discount']).trigger('change');

         }
       },1000);


     },
     complete: function() {
       $("#gsttaxtable").empty();
       calculation();
     }

  });
}

function setnewtaxtable(taxvalue){

     var temp = parseFloat(taxvalue);

     var tsetid =temp*1000;

     $("#cnewtax"+tsetid).remove();
     $("#snewtax"+tsetid).remove();
     var halftaxvalue = temp/2;
     var hsetid = halftaxvalue.toFixed(3)*1000;
     var taxhtml = "";
     var sum=0;
     $('#DyanmicTable tbody td:nth-child(1)').each(function () {
           var value = parseInt($(this).html());
           var tax = $('#tax'+value).val();

           if(taxvalue===tax){
             var amount = $('#amount'+value).val();
             sum = sum + parseFloat(amount);

           }
     });

     var gstval = $("#CGST"+hsetid).val();

     if(sum>0){
       if(gstval==undefined){
         taxhtml += "<tr id=cnewtax"+tsetid+">";
         taxhtml += "<td><strong><span id=mcgst"+hsetid+"></span></strong></td>";
         taxhtml += '<td><div class="row"><div class="col-sm-8"><input type="text" class="form-control form-control-sm" value="0.00"  id="CGST'+hsetid+'" readonly></div></div></td>';
         taxhtml += "</tr>";
         taxhtml += "<tr id=snewtax"+tsetid+">";
         taxhtml += "<td><strong><span id=msgst"+hsetid+"></span></strong></td>";
         taxhtml += '<td><div class="row"><div class="col-sm-8"><input type="text" class="form-control form-control-sm" value="0.00"  id="SGST'+hsetid+'" readonly></div></div></td>';
         taxhtml += "</tr>";
         $("#gsttaxtable").append(taxhtml);
       }
         $("#mcgst"+hsetid).html("CGST @ "+halftaxvalue.toFixed(2)+"% on "+sum.toFixed(2));
         $("#msgst"+hsetid).html("SGST @ "+halftaxvalue.toFixed(2)+"% on "+sum.toFixed(2));
         var cval = sum*(halftaxvalue/100);
         $("#CGST"+hsetid).val(cval.toFixed(2));
         $("#SGST"+hsetid).val(cval.toFixed(2));
     }
     calculation();


}
function settaxintable(param){
  var taxvalue = $("#tax"+param).val();

  if(taxvalue==="#at"){
     // $("#TaxModal").show();
     $('#hiddenitemtax').val(param);
     $('#TaxModal').modal('show');
     $("#tax"+param).val("");
     // connectitemtax(param);
  }
  else
  {
  var previousoriginaltax;
  var hiddentaxvalue = $("#hiddentax"+param).text();

  if(hiddentaxvalue==="" || hiddentaxvalue===undefined){
   $("#hiddentax"+param).text(taxvalue);
  }
  else{
    previousoriginaltax = hiddentaxvalue;
    setnewtaxtable(previousoriginaltax);
    $("#hiddentax"+param).text(taxvalue);
  }


  if(taxvalue===""){

  }
  else {

    var tsetid = (parseFloat(taxvalue).toFixed(3))*1000;

    var halftaxvalue = taxvalue/2;
    var hsetid = halftaxvalue.toFixed(3)*1000;

    var taxhtml = "";
    var sum=0;
    $('#DyanmicTable tbody td:nth-child(1)').each(function () {
          var value = parseInt($(this).html());
          var tax = $('#tax'+value).val();

          if(taxvalue===tax){
            var amount = $('#amount'+value).val();
            sum = sum + parseFloat(amount);

          }
    });

    var gstval = $("#CGST"+hsetid).val();

    if(gstval==undefined){
      taxhtml += "<tr id=cnewtax"+tsetid+">";
      taxhtml += "<td><strong><span id=mcgst"+hsetid+"></span></strong></td>";
      taxhtml += '<td><div class="row"><div class="col-sm-8"><input type="text" class="form-control form-control-sm" value="0.00"  id="CGST'+hsetid+'" readonly></div></div></td>';
      taxhtml += "</tr>";
      taxhtml += "<tr id=snewtax"+tsetid+">";
      taxhtml += "<td><strong><span id=msgst"+hsetid+"></span></strong></td>";
      taxhtml += '<td><div class="row"><div class="col-sm-8"><input type="text" class="form-control form-control-sm" value="0.00"  id="SGST'+hsetid+'" readonly></div></div></td>';
      taxhtml += "</tr>";
      $("#gsttaxtable").append(taxhtml);
    }
      $("#mcgst"+hsetid).html("CGST @ "+halftaxvalue+"% on "+sum);
      $("#msgst"+hsetid).html("SGST @ "+halftaxvalue+"% on "+sum);
      var cval = sum*(halftaxvalue/100);

      $("#CGST"+hsetid).val(cval.toFixed(2));
      $("#SGST"+hsetid).val(cval.toFixed(2));
      calculation();

  }
}
}

function clear_items()
{
$("#itemname").val('');
$("#itemquantity").val('');
}
function rowElim(t,value) {
    var taxval = $("#tax"+value).val();
    $("#rem"+value).remove();
    setnewtaxtable(taxval);
}
// function addrow(){
//   rowAgreg();
// }
function rowAgreg() {

   var tr = $('#DyanmicTable tbody tr:last');
   var firstcolumnval =   $(tr).find("td").html();
   var rows = $('#DyanmicTable tbody tr').length;
   if(rows<firstcolumnval){
     rows=parseInt(firstcolumnval);
   }
   if((firstcolumnval===undefined)||(rows===0)){
     var t = "";
     var value = rows+1;
   t +='<td> '+(rows+1)+'</td>';
   t +='<td>';
   t +='<input type="hidden" id="itemdetailid'+(rows+1)+'">';
   t +='<span id=itemspan'+(rows+1)+'></span>';
   t +='</td>';
   t +='<td>';
   t +='  <input type="text" class="form-control" placeholder="HSN/SAC " id="hsn'+(rows+1)+'" readonly>';
   t +='</td>';
   t +='<td>';
   t +='<span id=iteminvdesc'+(rows+1)+'></span>';
   t +='<input type="hidden" id="unitsubpackingqty'+(rows+1)+'"/>';
   t +='<input type="hidden" id="unitpackingqty'+(rows+1)+'"/>';
   // t +='  <input type="text" class="form-control" placeholder="DESCRIPTION " id="desc'+(rows+1)+'">';
   t +='</td>';
   t +='<td>';
   t +='<div class="row">';
   t +='<div class="col-sm-12">';
   t +='<div class="form-group">';
   t +='<input type="text" class="form-control" value="1" data-provide="tooltip" data-placement="top"  title="Quantity in hand 10" id="qty'+(rows+1)+'" onchange="setamount1('+value+')" onkeypress="return isNumberInt(event);">';
   t +='<input type="hidden" id="hiddenqtyonhand'+(rows+1)+'">';
   t +='<input type="hidden" id="hiddenlowstockalert'+(rows+1)+'">';
   t +='<input type="hidden" id="unitremainqty'+(rows+1)+'"/>';
   // t +='<a data-toggle="collapse" data-parent="#accordion-1" href="#collapse'+(rows+1)+'" aria-expanded="false" class="collapsed">Check</a>';
   // t +='<div id="collapse'+(rows+1)+'" class="collapse" >';
   // t +='<font color="green">Qty on hand <span id="qtyonhand">0</span></font></br>';
   // t +='<font color="orange">Low Stock alert <span id="lowstockalert">0</span></font>';
   // t +='</div>';
   t +='</div>';
   t +='</div>';
   t +='</div>';
   // t +='<div class="col-sm-2">';
  //  t +='<button type="button" class="btn btn-secondary" data-provide="popover" data-placement="top" title="Popover title" data-content="Vivamus sagittis lacus vel augue laoreet rutrum faucibus.">';
  // t +='   Popover on top';
  //  t +='</button>';
   // t +='<div class="form-group">';
   // t +='<span id=""><i class="fa fa-question" style="color:green" data-provide="popover" data-placement="top" title="" data-content="Vivamus sagittis lacus vel augue laoreet rutrum faucibus." data-original-title="Popover title" aria-describedby="popover106127" data-placement="left"></i></span>';
   // t +='</div>';


   t +='</td>';
   t +='<td>';
   t +='<div class="row">';
   t +='<div class="col-sm-12">';
   t +='<div class="form-group">';
   t +='<input type="text" class="form-control" value="1" data-provide="tooltip" data-placement="top"  title="Billing Quantity" id="billingqty'+(rows+1)+'" readonly/>';
   // t +='<input type="hidden" id="hiddenqtyonhand'+(rows+1)+'">';
   // t +='<input type="hidden" id="hiddenlowstockalert'+(rows+1)+'">';
   t +='</div>';
   t +='</div>';
   t +='</div>';
   t +='</td>';
   t +='<td>';
   t +='  <input type="text" class="form-control" value="0.00" placeholder="RATE" id="rate'+(rows+1)+'" onchange="setamount('+value+')" onkeypress="return isNumberKey(event);">';
   t +='</td>';
   t +='<td>';
   t +='  <input type="text" class="form-control" value="0.00" placeholder="Discount" id="itemdiscount'+(rows+1)+'" onkeypress="return isNumberKey(event);" onchange="setamount('+value+')" >';
   t +='</td>';
   t +='<td>';
   t +='  <input type="text" class="form-control" value="0.00" placeholder="AMOUNT" id="amount'+(rows+1)+'" readonly>';
   t +='</td>';

   t +='<td>';
   t +='<input type="hidden" id="hiddentax'+(rows+1)+'"/>';
   t +='<span id=taxspan'+(rows+1)+'></span>';
   t +='</td>';
   t += '<td name="buttons" class="text-center"><div class="btn-group ">';
   t += '<button id="bElim" type="button" class="btn btn-square btn-outline btn-pure btn-danger" onclick="rowElim(this,'+(rows+1)+');">';
   t += '<i class="ti-close"></i>';
   t += '</button>';
   t += '</div></td>';

   $tab_en_edic.find("tbody").append("<tr id=rem"+(rows+1)+">" + t + "</tr>");
   connectitemname(value);
   connectitemtax(value);
   connectitemunit(value);

   }
   else {
     var t = "";
     var value = rows+1;
     t +='<td> '+(rows+1)+'</td>';
     t +='<td>';
     t +='<input type="hidden" id="itemdetailid'+(rows+1)+'">';
     t +='<span id=itemspan'+(rows+1)+'></span>';
     t +='</td>';
     t +='<td>';
     t +='  <input type="text" class="form-control" placeholder="HSN/SAC " id="hsn'+(rows+1)+'" readonly>';
     t +='</td>';
     t +='<td>';
     t +='<span id=iteminvdesc'+(rows+1)+'></span>';
     t +='<input type="hidden" id="unitsubpackingqty'+(rows+1)+'"/>';
     t +='<input type="hidden" id="unitpackingqty'+(rows+1)+'"/>';
       t +='<input type="hidden" id="unitremainqty'+(rows+1)+'"/>';
     // t +='  <input type="text" class="form-control" placeholder="DESCRIPTION " id="desc'+(rows+1)+'">';
     t +='</td>';
     t +='<td>';
     t +='<div class="row">';
     t +='<div class="col-sm-12">';
     t +='<div class="form-group">';
     t +='<input type="text" class="form-control"  value="1"  placeholder="QTY" id="qty'+(rows+1)+'" onchange="setamount1('+value+')" data-provide="tooltip" data-placement="top"  title="Quantity in hand 0" onkeypress="return isNumberInt(event);">';
     t +='<input type="hidden" id="hiddenqtyonhand'+(rows+1)+'">';
     t +='<input type="hidden" id="hiddenlowstockalert'+(rows+1)+'">';
     // t +='<a data-toggle="collapse" data-parent="#accordion-1" href="#collapse'+(rows+1)+'" aria-expanded="false" class="collapsed">Check</a>';
     // t +='<div id="collapse'+(rows+1)+'" class="collapse" >';
     // t +='<font color="green">Qty on hand <span id="qtyonhand">0</span></font></br>';
     // t +='<font color="orange">Low Stock alert <span id="lowstockalert">0</span></font>';
     // t +='</div>';
     t +='</div>';
     t +='</div>';
     t +='</div>';
      // t +='<h6 title="Select Size" data-provide="tooltip" >Size Value</h6>';
     // t +='  <input type="text" class="form-control" title="Select Size" data-provide="tooltip" value="1" placeholder="QTY" id="qty'+(rows+1)+'" onchange="setamount('+value+')" onkeypress="return isNumberInt(event);">';
     t +='</td>';
     t +='<td>';
     t +='<div class="row">';
     t +='<div class="col-sm-12">';
     t +='<div class="form-group">';
     t +='<input type="text" class="form-control" value="1" data-provide="tooltip" data-placement="top"  title="Billing Quantity" id="billingqty'+(rows+1)+'" readonly/>';
     // t +='<input type="hidden" id="hiddenqtyonhand'+(rows+1)+'">';
     // t +='<input type="hidden" id="hiddenlowstockalert'+(rows+1)+'">';
     t +='</div>';
     t +='</div>';
     t +='</div>';
     t +='</td>';
     t +='<td>';
     t +='  <input type="text" class="form-control" value="0.00" placeholder="RATE" id="rate'+(rows+1)+'" onchange="setamount('+value+')" onkeypress="return isNumberKey(event);">';
     t +='</td>';
     t +='<td>';
     t +='  <input type="text" class="form-control" value="0.00" placeholder="Discount" id="itemdiscount'+(rows+1)+'" onkeypress="return isNumberKey(event);" onchange="setamount('+value+')">';
     t +='</td>';
     t +='<td>';
     t +='  <input type="text" class="form-control" value="0.00" placeholder="AMOUNT" id="amount'+(rows+1)+'" readonly>';
     t +='</td>';

     t +='<td>';
     t +='<input type="hidden" id="hiddentax'+(rows+1)+'"/>';
     t +='<span id=taxspan'+(rows+1)+'></span>';
     t +='</td>';
     t += '<td name="buttons" class="text-center"><div class="btn-group ">';
     t += '<button id="bElim" type="button" class="btn btn-square btn-outline btn-pure btn-danger" onclick="rowElim(this,'+(rows+1)+');">';
     t += '<i class="ti-close"></i>';
     t += '</button>';
     t += '</div></td>';
     $tab_en_edic.find("tbody").append("<tr id=rem"+(rows+1)+">" + t + "</tr>");
     connectitemname(value);
     connectitemtax(value);
     connectitemunit(value);
   }

}

var $tab_en_edic = null;
var  params = null;
var  colsEdi = null;
var colEdicHtml = '';
$.fn.SetEditable = function(t) {
    var n = {
        columnsEd: null,
        $addButton: null,
        // onEdit: function() {},
        // onDelete: function() {},
        onAdd: function() {}
    };
    params = $.extend(n, t), this.find("thead tr").append('<th name="buttons" class="text-center" style="width: 50"><strong>Action</strong></th>'),
    this.find("tbody tr").append(colEdicHtml), $tab_en_edic = this, null != params.$addButton && params.$addButton.click(function() {
        rowAgreg()
    }), null != params.columnsEd && (colsEdi = params.columnsEd.split(","))
};
