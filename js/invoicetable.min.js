// function specialshippingqty(itemid,itemqty){
//
//
// }
function setamount1(value){
  var itemname = $('#itemdetailid'+value).val();

  if(itemname===""){
    var param1="Please Select Item Name";
            app.toast(param1, {
              actionTitle: 'warning',
              // actionUrl: 'something',
              actionColor: 'warning'
            });
  }
  else{
      var qty = parseInt($('#qty'+value).val());
      $.ajax({
          type: "POST",
          url:"../src/fetchspecialshippingqty.php",
          data:{
            itemid:itemname,
            itemqty:qty
          },
          success: function(msg) {
             var response = JSON.parse(msg);

             $("#billingqty"+value).val(response['BillQty']);
             setamount(value);
          }
      });
  }
}
function setamount(value){

  var hiddenqtyonhand = parseInt($('#hiddenqtyonhand'+value).val());

  var qty = parseInt($('#qty'+value).val());
  var billingqty = parseFloat($('#billingqty'+value).val());
  if(billingqty===0){
    billingqty =qty;
  }
  // var shipqty= specialshippingqty(itemname,qty);
   // alert(shipqty);
  var formid = $("#hiddenformid").val();
  var hiddenformtype = $("#hiddenformtype").val();
  var itemdiscount = parseFloat($("#itemdiscount"+value).val());
  // alert(itemdiscount);
  if(isNaN(itemdiscount) || itemdiscount<=0){
    itemdiscount =0.0000000000000001;
  }

  if(formid==="1"){
      // alert(hiddenqtyonhand);
    if(hiddenformtype==="U"){
      if(hiddenqtyonhand==0){
        $('#qty'+value).val(qty);
      }
      // else{
      //   qty=hiddenqtyonhand;
      //   $('#qty'+value).val(qty);
      // }
    }
    else {
      if(hiddenqtyonhand<=qty){

        qty=hiddenqtyonhand;
        $('#qty'+value).val(qty);
      }
    }

  }
  var rate = $('#rate'+value).val();
  var amount = billingqty * rate;
  amount = amount - (amount * (itemdiscount/100));
  // alert(finalamount);
  $('#amount'+value).val(amount.toFixed(2));
  settaxintable(value);
  calculation();

}
function setdiscount(){
  var subtotal = 0;
  var total = 0;
  var i = 0;
  $('#DyanmicTable tbody td:nth-child(1)').each(function () {
        var value = parseInt($(this).html());
        var amount = $('#amount'+value).val();
        subtotal = subtotal + parseFloat(amount);
  });

  $('#gsttaxtable tr td:nth-child(1)').each(function () {
        var value = $(this).html();
        var arr = value.split("@");
        var arr1 = arr[1].split("%");

        if(i==0){
          var cgst = $("#CGST"+(arr1[0]*1000)).val();

          var sgst = $("#SGST"+(arr1[0]*1000)).val();
          total = total + parseFloat(cgst) + parseFloat(sgst);
          i=1;
        }
        else
        {
          i=0;
        }
  });
  total = total + subtotal;
  // alert(total);
  var discount = parseFloat($("#discount").val());
  if((discount>0) && (discount<100) ){
    var answer = total * (discount/100);
    var ansprocess =  total-answer;
    $('#finaltotal').text(ansprocess.toFixed(2));
  }
  else {
    $("#discount").val("0.0");
  }

}
function connectitemname(value){
      $.ajax({
          type: "POST",
          url: "../src/fetch_itemnames.php",
          success: function(msg) {
            var itemspan='';
            itemspan+='<select class="form-control" data-provide="selectpicker" data-live-search="true"  title="Choose a items" id="itemname'+(value)+'" onchange="getiteminform('+value+')">';
            itemspan+=msg;
            itemspan+='<option data-icon="fa fa-edit" style="font-weight: bold;  padding: 5px;color: #797878;border: 2px solid #71bd71;"  value="#ai" >Add Items</option>';
            itemspan+='<option value=""></option>';
            itemspan+='</select>';

            $("#itemspan"+value).html(itemspan);
          }
      });
}
function gettaxvaluefromtaxid(param,value){
  $.ajax({
      type: "POST",
      url: "../src/fetchtaxvaluefromtaxid.php",
      data:{
        taxid:param
      },
      success: function(msg) {
         var response = JSON.parse(msg);
          $('#tax'+value).val(response['TaxPercent']).trigger('change');
      }
  });
}
function getiteminform(param){
  // alert(param);
  var itemname = $("#itemname"+param).val();
  // alert(itemname);
  if(itemname==="#ai"){
    $('#hiddenitemnameid').val(param);

    $('#ItemModal').modal('show');
    $("#itemname"+param).val("");

     $("#NewItemName").val("");
  }
  else{
    $.ajax({
        type: "POST",
        url: "../src/fetchitemnameinfobyid.php",
        data:{
          itemname:parseInt(itemname)
        },
        success: function(msg) {
          // alert(msg);
          var response = JSON.parse(msg);
          var count = Object.keys(response).length;
          if(count>0){

           $('#desc'+param).val(response['Description']);
           $('#hsn'+param).val(response['HSN']);
           // $('#qty'+param).val(response['Quantity']);
           $('#qty'+param).val(1);
           $('#rate'+param).val(response['price']);
           $('#amount'+param).val(1*response['price']);
           $('#itemdetailid'+param).val(response['itemDetailId']);
           $('#hiddenqtyonhand'+param).val(response['Quantity']);
           $('#hiddenlowstockalert'+param).val(response['ReorderLabel']);
           $('#qty'+param).attr('title',"Quantity in hand "+response['Quantity']);
           gettaxvaluefromtaxid(response['TaxId'],param);
          }




        }
    });
  }

}
function additemsinfo()
{
    var itemname  = $('#itemname').val();
    var itemquantity  = $('#itemquantity').val();
    var value = $("#hiddenitemnameid").val();
    if(itemname === ""){
        $('#itemname').focus();
    }
    else if (itemquantity === "")
    {
       $('#itemquantity').focus();

    }
    else{
      $.ajax({
            type: "POST",
            url: "../src/AddNewitem.php",
            data:({itemname:itemname,itemquantity:itemquantity}),
            dataType:'json',
            success: function(response) {
              $('#ItemModal').modal('hide');
              connectitemname(value);
              clear_items();

            }
        });
    }
}
function connectitemtax(value){
      $.ajax({
          type: "POST",
          url: "../src/fetch_itemtax.php",
          success: function(msg) {
            var itemspan='';
            itemspan+='<select class="form-control" data-provide="selectpicker" data-live-search="true"  title="Choose a TAX" id="tax'+(value)+'" onchange="settaxintable('+value+')">';
            itemspan+=msg;
            itemspan+='<option data-icon="fa fa-edit" style="font-weight: bold;  padding: 5px;color: #797878;border: 2px solid #71bd71;"  value="#at" >Add Tax</option>';
            itemspan+='<option value=""></option>';
            itemspan+='</select>';

            $("#taxspan"+value).html(itemspan);
          }
      });
}
function calculation(){
  var subtotal = 0;
  var total = 0;
  var i = 0;
  $('#DyanmicTable tbody td:nth-child(1)').each(function () {
        var value = parseInt($(this).html());
        var amount = $('#amount'+value).val();
        subtotal = subtotal + parseFloat(amount);
  });

  $('#gsttaxtable tr td:nth-child(1)').each(function () {
        var value = $(this).html();
        var arr = value.split("@");
        var arr1 = arr[1].split("%");
        // alert(arr1[0]);
        if(i==0){
          // alert("#CGST"+(arr1[0]*1000));
          var cgst = $("#CGST"+(arr1[0]*1000)).val();
          // alert(cgst);
          var sgst = $("#SGST"+(arr1[0]*1000)).val();
          total = total + parseFloat(cgst) + parseFloat(sgst);
          i=1;
        }
        else
        {
          i=0;
        }
  });
  total = total + subtotal;
  if(total>0){
  $("#discount").val("0.00");
  $("#hidediscount").show();
  }
  else{
      $("#discount").val("0.00");
    $("#hidediscount").hide();
  }

  $('#subtotal').text(subtotal.toFixed(2));
  $('#total').text(total.toFixed(2));
  $('#finaltotal').text(total.toFixed(2));
  $('#balancedue').text(total.toFixed(2));
}
function getFormattedDate(date) {
    let year = date.getFullYear();
    let month = (1 + date.getMonth()).toString().padStart(2, '0');
    let day = date.getDate().toString().padStart(2, '0');

    return month + '/' + day + '/' + year;
}
function editappenditemtable(param){

  $.ajax({
      type: "GET",
      async:false,
      // async: true,
      // async:true ,
      // cache:true,
      // async: false,
      url: "../src/fetchappenditemtable.php",
      data:({
        transactionno:param
      }),
      success: function(msg) {
        var rows = 0;
        var n =0;
        var t;
        var response = JSON.parse(msg);
        // alert(msg);
        $("#customername").val(response[0]['PersonId']).trigger('change');

        var date1 = new Date(response[0]['DateCreated']);
        var date2 = new Date(response[0]['DueDate']);
        var timeDiff = Math.abs(date2.getTime() - date1.getTime());
        var diffDays = Math.ceil(timeDiff / (1000 * 3600 * 24));

        $("#remark").val(response[0]['remarks']);
        $("#terms").val(diffDays).trigger('change');
        var count = Object.keys(response).length;
        for(n=0;n<count;n++){
          rows = n;
          t +='<tr id=rem'+(rows+1)+'><td> '+(rows+1)+'</td>';
          t +='<td>';
          t +='<input type="hidden" id="itemdetailid'+(rows+1)+'">';
          t +='<span id=itemspan'+(rows+1)+'></span>';
          t +='</td>';
          t +='<td>';
          t +='  <input type="text" class="form-control" placeholder="HSN/SAC " id="hsn'+(rows+1)+'" readonly>';
          t +='</td>';
          t +='<td>';
          t +='  <input type="text" class="form-control" placeholder="DESCRIPTION " id="desc'+(rows+1)+'">';
          t +='</td>';
          t +='<td>';
          t +='<div class="row">';
          t +='<div class="col-sm-12">';
          t +='<div class="form-group">';
          t +='<input type="text" class="form-control" value="1" data-provide="tooltip" data-placement="top"  title="Quantity in hand 0" id="qty'+(rows+1)+'" onchange="setamount1('+(rows+1)+')" onkeypress="return isNumberInt(event);">';
          t +='<input type="hidden" id="hiddenqtyonhand'+(rows+1)+'">';
          t +='<input type="hidden" id="hiddenlowstockalert'+(rows+1)+'">';
          t +='</div>';
          t +='</div>';
          t +='</div>';
          t +='</td>';
          t +='<td>';
          t +='<div class="row">';
          t +='<div class="col-sm-12">';
          t +='<div class="form-group">';
          t +='<input type="text" class="form-control" value="1" data-provide="tooltip" data-placement="top"  title="Billing Quantity" id="billingqty'+(rows+1)+'" readonly/>';
          // t +='<input type="hidden" id="hiddenqtyonhand'+(rows+1)+'">';
          // t +='<input type="hidden" id="hiddenlowstockalert'+(rows+1)+'">';
          t +='</div>';
          t +='</div>';
          t +='</div>';
          t +='</td>';
          t +='<td>';
          t +='  <input type="text" class="form-control" value="0.00" placeholder="RATE" id="rate'+(rows+1)+'" onchange="setamount('+(rows+1)+')" onkeypress="return isNumberKey(event);">';
          t +='</td>';
          t +='<td>';
          t +='  <input type="text" class="form-control" value="0.00" placeholder="Discount" id="itemdiscount'+(rows+1)+'" onkeypress="return isNumberKey(event);" onchange="setamount('+(rows+1)+')" >';
          t +='</td>';
          t +='<td>';
          t +='  <input type="text" class="form-control" value="0.00" placeholder="AMOUNT" id="amount'+(rows+1)+'" readonly>';
          t +='</td>';

          t +='<td>';
          t +='<input type="hidden" id="hiddentax'+(rows+1)+'"/>';
          t +='<span id=taxspan'+(rows+1)+'></span>';
          t +='</td>';
          t += '<td name="buttons" class="text-center"><div class="btn-group ">';
          t += '<button id="bElim" type="button" class="btn btn-square btn-outline btn-pure btn-danger" onclick="rowElim(this,'+(rows+1)+');">';
          t += '<i class="ti-close"></i>';
          t += '</button>';
          t += '</div></td></tr>';

          connectitemname(rows+1);
          connectitemtax(rows+1);
            // $("#itemname"+(newval+1)).val(parseInt(response[i]['itemid']));

        }
        $('#DyanmicTable tbody').append("" + t + "");
        // $tab_en_edic.find("tbody").append("" + t + "");
        // setTimeout(function()
        // {
        //   alert("ok");
        // }, 2000);

       setTimeout(function()
       {
         var newval = 0;
         for(var j=0;j<count;j++){
          newval = j+1;
          // alert(response[j]['itemid']);

          $("#itemname"+newval).val(response[j]['itemid']).trigger('change');
          $("#hsn"+newval).val(response[j]['hsn']);
         }
       },500);
       // setTimeout(function()
       // {
       //   var newval = 0;
       //   for(var j=0;j<count;j++){
       //    newval = j+1;
       //    // alert(response[j]['itemid']);
       //
       //    $("#tax"+newval).val(response[j]['TaxPercent']).trigger('change');
       //   }
       // },500);



       setTimeout(function()
       {
         var newval = 0;
         for(var j=0;j<count;j++){
          newval = j+1;
          var discountval = response[j]['itemdiscount'];
          // alert(discountval);
          if(discountval==0){
            discountval = 0.0;
            // alert(discountval);
          }
           // alert(response[j]['itemid']);
          // alert(response[j]['qty']);

          $("#tax"+newval).val(response[j]['TaxPercent']).trigger('change');
          $("#qty"+newval).val(response[j]['qty']).trigger('change');
          $("#rate"+newval).val(response[j]['rate']).trigger('change');
          $("#amount"+newval).val(response[j]['rate']*response[j]['qty']);
            $("#itemdiscount"+newval).val(discountval).trigger('change');
          // $("#discount").val(response[j]['discount']).trigger('change');

         }
       },1000);


     },
     complete: function() {
       $("#gsttaxtable").empty();
       calculation();
     }

  });
}

function setnewtaxtable(taxvalue){
      // alert(taxvalue);
     var temp = parseFloat(taxvalue);

     var tsetid =temp*1000;
     // alert("setnewtaxtable"+tsetid);
     $("#cnewtax"+tsetid).remove();
     $("#snewtax"+tsetid).remove();
     var halftaxvalue = temp/2;
     var hsetid = halftaxvalue.toFixed(3)*1000;
     var taxhtml = "";
     var sum=0;
     $('#DyanmicTable tbody td:nth-child(1)').each(function () {
           var value = parseInt($(this).html());
           var tax = $('#tax'+value).val();
           // alert(tax);
           if(taxvalue===tax){
             var amount = $('#amount'+value).val();
             sum = sum + parseFloat(amount);
             // alert("if"+amount);
           }
     });
     // alert("newtable"+sum);
     var gstval = $("#CGST"+hsetid).val();
      // alert(gstval);
     if(sum>0){
       if(gstval==undefined){
         taxhtml += "<tr id=cnewtax"+tsetid+">";
         taxhtml += "<td><strong><span id=mcgst"+hsetid+"></span></strong></td>";
         taxhtml += '<td><div class="row"><div class="col-sm-8"><input type="text" class="form-control form-control-sm" value="0.00"  id="CGST'+hsetid+'" readonly></div></div></td>';
         taxhtml += "</tr>";
         taxhtml += "<tr id=snewtax"+tsetid+">";
         taxhtml += "<td><strong><span id=msgst"+hsetid+"></span></strong></td>";
         taxhtml += '<td><div class="row"><div class="col-sm-8"><input type="text" class="form-control form-control-sm" value="0.00"  id="SGST'+hsetid+'" readonly></div></div></td>';
         taxhtml += "</tr>";
         $("#gsttaxtable").append(taxhtml);
       }
         $("#mcgst"+hsetid).html("CGST @ "+halftaxvalue.toFixed(2)+"% on "+sum.toFixed(2));
         $("#msgst"+hsetid).html("SGST @ "+halftaxvalue.toFixed(2)+"% on "+sum.toFixed(2));
         var cval = sum*(halftaxvalue/100);
         $("#CGST"+hsetid).val(cval.toFixed(2));
         $("#SGST"+hsetid).val(cval.toFixed(2));
     }
     calculation();


}
function settaxintable(param){
  var taxvalue = $("#tax"+param).val();
 // alert("currenttaxval"+taxvalue);
  if(taxvalue==="#at"){
     // $("#TaxModal").show();
     $('#hiddenitemtax').val(param);
     $('#TaxModal').modal('show');
     $("#tax"+param).val("");
     // connectitemtax(param);
  }
  else
  {
  var previousoriginaltax;
  var hiddentaxvalue = $("#hiddentax"+param).text();
  // alert(hiddentaxvalue);
  if(hiddentaxvalue==="" || hiddentaxvalue===undefined){
   $("#hiddentax"+param).text(taxvalue);
  }
  else{
    previousoriginaltax = hiddentaxvalue;
    setnewtaxtable(previousoriginaltax);
    $("#hiddentax"+param).text(taxvalue);
  }


  if(taxvalue===""){
      // alert("empty");
  }
  else {

    var tsetid = (parseFloat(taxvalue).toFixed(3))*1000;
    // alert(tsetid);
    var halftaxvalue = taxvalue/2;
    var hsetid = halftaxvalue.toFixed(3)*1000;
     // alert(hsetid);
    var taxhtml = "";
    var sum=0;
    $('#DyanmicTable tbody td:nth-child(1)').each(function () {
          var value = parseInt($(this).html());
          var tax = $('#tax'+value).val();
          // alert(tax);
          if(taxvalue===tax){
            var amount = $('#amount'+value).val();
            sum = sum + parseFloat(amount);
            // alert("if"+amount);
          }
    });
    // alert("mainsum"+sum);
    var gstval = $("#CGST"+hsetid).val();
     // alert(gstval);
    if(gstval==undefined){
      taxhtml += "<tr id=cnewtax"+tsetid+">";
      taxhtml += "<td><strong><span id=mcgst"+hsetid+"></span></strong></td>";
      taxhtml += '<td><div class="row"><div class="col-sm-8"><input type="text" class="form-control form-control-sm" value="0.00"  id="CGST'+hsetid+'" readonly></div></div></td>';
      taxhtml += "</tr>";
      taxhtml += "<tr id=snewtax"+tsetid+">";
      taxhtml += "<td><strong><span id=msgst"+hsetid+"></span></strong></td>";
      taxhtml += '<td><div class="row"><div class="col-sm-8"><input type="text" class="form-control form-control-sm" value="0.00"  id="SGST'+hsetid+'" readonly></div></div></td>';
      taxhtml += "</tr>";
      $("#gsttaxtable").append(taxhtml);
    }
      $("#mcgst"+hsetid).html("CGST @ "+halftaxvalue+"% on "+sum);
      $("#msgst"+hsetid).html("SGST @ "+halftaxvalue+"% on "+sum);
      var cval = sum*(halftaxvalue/100);

      $("#CGST"+hsetid).val(cval.toFixed(2));
      $("#SGST"+hsetid).val(cval.toFixed(2));
      calculation();

  }
}
}

function clear_items()
{
$("#itemname").val('');
$("#itemquantity").val('');
}
function rowElim(t,value) {
    var taxval = $("#tax"+value).val();
    $("#rem"+value).remove();
    setnewtaxtable(taxval);
}
// function addrow(){
//   rowAgreg();
// }
function rowAgreg() {
   // alert("ok");
   var tr = $('#DyanmicTable tbody tr:last');
   var firstcolumnval =   $(tr).find("td").html();
   var rows = $('#DyanmicTable tbody tr').length;
   if(rows<firstcolumnval){
     rows=parseInt(firstcolumnval);
   }
   if((firstcolumnval===undefined)||(rows===0)){
     var t = "";
     var value = rows+1;
   t +='<td> '+(rows+1)+'</td>';
   t +='<td>';
   t +='<input type="hidden" id="itemdetailid'+(rows+1)+'">';
   t +='<span id=itemspan'+(rows+1)+'></span>';
   t +='</td>';
   t +='<td>';
   t +='  <input type="text" class="form-control" placeholder="HSN/SAC " id="hsn'+(rows+1)+'" readonly>';
   t +='</td>';
   t +='<td>';
   t +='  <input type="text" class="form-control" placeholder="DESCRIPTION " id="desc'+(rows+1)+'">';
   t +='</td>';
   t +='<td>';
   t +='<div class="row">';
   t +='<div class="col-sm-12">';
   t +='<div class="form-group">';
   t +='<input type="text" class="form-control" value="1" data-provide="tooltip" data-placement="top"  title="Quantity in hand 10" id="qty'+(rows+1)+'" onchange="setamount1('+value+')" onkeypress="return isNumberInt(event);">';
   t +='<input type="hidden" id="hiddenqtyonhand'+(rows+1)+'">';
   t +='<input type="hidden" id="hiddenlowstockalert'+(rows+1)+'">';
   // t +='<a data-toggle="collapse" data-parent="#accordion-1" href="#collapse'+(rows+1)+'" aria-expanded="false" class="collapsed">Check</a>';
   // t +='<div id="collapse'+(rows+1)+'" class="collapse" >';
   // t +='<font color="green">Qty on hand <span id="qtyonhand">0</span></font></br>';
   // t +='<font color="orange">Low Stock alert <span id="lowstockalert">0</span></font>';
   // t +='</div>';
   t +='</div>';
   t +='</div>';
   t +='</div>';
   // t +='<div class="col-sm-2">';
  //  t +='<button type="button" class="btn btn-secondary" data-provide="popover" data-placement="top" title="Popover title" data-content="Vivamus sagittis lacus vel augue laoreet rutrum faucibus.">';
  // t +='   Popover on top';
  //  t +='</button>';
   // t +='<div class="form-group">';
   // t +='<span id=""><i class="fa fa-question" style="color:green" data-provide="popover" data-placement="top" title="" data-content="Vivamus sagittis lacus vel augue laoreet rutrum faucibus." data-original-title="Popover title" aria-describedby="popover106127" data-placement="left"></i></span>';
   // t +='</div>';


   t +='</td>';
   t +='<td>';
   t +='<div class="row">';
   t +='<div class="col-sm-12">';
   t +='<div class="form-group">';
   t +='<input type="text" class="form-control" value="1" data-provide="tooltip" data-placement="top"  title="Billing Quantity" id="billingqty'+(rows+1)+'" readonly/>';
   // t +='<input type="hidden" id="hiddenqtyonhand'+(rows+1)+'">';
   // t +='<input type="hidden" id="hiddenlowstockalert'+(rows+1)+'">';
   t +='</div>';
   t +='</div>';
   t +='</div>';
   t +='</td>';
   t +='<td>';
   t +='  <input type="text" class="form-control" value="0.00" placeholder="RATE" id="rate'+(rows+1)+'" onchange="setamount('+value+')" onkeypress="return isNumberKey(event);">';
   t +='</td>';
   t +='<td>';
   t +='  <input type="text" class="form-control" value="0.00" placeholder="Discount" id="itemdiscount'+(rows+1)+'" onkeypress="return isNumberKey(event);" onchange="setamount('+value+')" >';
   t +='</td>';
   t +='<td>';
   t +='  <input type="text" class="form-control" value="0.00" placeholder="AMOUNT" id="amount'+(rows+1)+'" readonly>';
   t +='</td>';

   t +='<td>';
   t +='<input type="hidden" id="hiddentax'+(rows+1)+'"/>';
   t +='<span id=taxspan'+(rows+1)+'></span>';
   t +='</td>';
   t += '<td name="buttons" class="text-center"><div class="btn-group ">';
   t += '<button id="bElim" type="button" class="btn btn-square btn-outline btn-pure btn-danger" onclick="rowElim(this,'+(rows+1)+');">';
   t += '<i class="ti-close"></i>';
   t += '</button>';
   t += '</div></td>';

   $tab_en_edic.find("tbody").append("<tr id=rem"+(rows+1)+">" + t + "</tr>");
   connectitemname(value);
   connectitemtax(value);

   }
   else {
     var t = "";
     var value = rows+1;
     t +='<td> '+(rows+1)+'</td>';
     t +='<td>';
     t +='<input type="hidden" id="itemdetailid'+(rows+1)+'">';
     t +='<span id=itemspan'+(rows+1)+'></span>';
     t +='</td>';
     t +='<td>';
     t +='  <input type="text" class="form-control" placeholder="HSN/SAC " id="hsn'+(rows+1)+'" readonly>';
     t +='</td>';
     t +='<td>';
     t +='  <input type="text" class="form-control" placeholder="DESCRIPTION " id="desc'+(rows+1)+'">';
     t +='</td>';
     t +='<td>';
     t +='<div class="row">';
     t +='<div class="col-sm-12">';
     t +='<div class="form-group">';
     t +='<input type="text" class="form-control"  value="1"  placeholder="QTY" id="qty'+(rows+1)+'" onchange="setamount1('+value+')" data-provide="tooltip" data-placement="top"  title="Quantity in hand 0" onkeypress="return isNumberInt(event);">';
     t +='<input type="hidden" id="hiddenqtyonhand'+(rows+1)+'">';
     t +='<input type="hidden" id="hiddenlowstockalert'+(rows+1)+'">';
     // t +='<a data-toggle="collapse" data-parent="#accordion-1" href="#collapse'+(rows+1)+'" aria-expanded="false" class="collapsed">Check</a>';
     // t +='<div id="collapse'+(rows+1)+'" class="collapse" >';
     // t +='<font color="green">Qty on hand <span id="qtyonhand">0</span></font></br>';
     // t +='<font color="orange">Low Stock alert <span id="lowstockalert">0</span></font>';
     // t +='</div>';
     t +='</div>';
     t +='</div>';
     t +='</div>';
      // t +='<h6 title="Select Size" data-provide="tooltip" >Size Value</h6>';
     // t +='  <input type="text" class="form-control" title="Select Size" data-provide="tooltip" value="1" placeholder="QTY" id="qty'+(rows+1)+'" onchange="setamount('+value+')" onkeypress="return isNumberInt(event);">';
     t +='</td>';
     t +='<td>';
     t +='<div class="row">';
     t +='<div class="col-sm-12">';
     t +='<div class="form-group">';
     t +='<input type="text" class="form-control" value="1" data-provide="tooltip" data-placement="top"  title="Billing Quantity" id="billingqty'+(rows+1)+'" readonly/>';
     // t +='<input type="hidden" id="hiddenqtyonhand'+(rows+1)+'">';
     // t +='<input type="hidden" id="hiddenlowstockalert'+(rows+1)+'">';
     t +='</div>';
     t +='</div>';
     t +='</div>';
     t +='</td>';
     t +='<td>';
     t +='  <input type="text" class="form-control" value="0.00" placeholder="RATE" id="rate'+(rows+1)+'" onchange="setamount('+value+')" onkeypress="return isNumberKey(event);">';
     t +='</td>';
     t +='<td>';
     t +='  <input type="text" class="form-control" value="0.00" placeholder="Discount" id="itemdiscount'+(rows+1)+'" onkeypress="return isNumberKey(event);" onchange="setamount('+value+')">';
     t +='</td>';
     t +='<td>';
     t +='  <input type="text" class="form-control" value="0.00" placeholder="AMOUNT" id="amount'+(rows+1)+'" readonly>';
     t +='</td>';

     t +='<td>';
     t +='<input type="hidden" id="hiddentax'+(rows+1)+'"/>';
     t +='<span id=taxspan'+(rows+1)+'></span>';
     t +='</td>';
     t += '<td name="buttons" class="text-center"><div class="btn-group ">';
     t += '<button id="bElim" type="button" class="btn btn-square btn-outline btn-pure btn-danger" onclick="rowElim(this,'+(rows+1)+');">';
     t += '<i class="ti-close"></i>';
     t += '</button>';
     t += '</div></td>';
     $tab_en_edic.find("tbody").append("<tr id=rem"+(rows+1)+">" + t + "</tr>");
     connectitemname(value);
     connectitemtax(value);

   }

}

var $tab_en_edic = null;
var  params = null;
var  colsEdi = null;
var colEdicHtml = '';
$.fn.SetEditable = function(t) {
    var n = {
        columnsEd: null,
        $addButton: null,
        // onEdit: function() {},
        // onDelete: function() {},
        onAdd: function() {}
    };
    params = $.extend(n, t), this.find("thead tr").append('<th name="buttons" class="text-center" style="width: 50"><strong>Action</strong></th>'),
    this.find("tbody tr").append(colEdicHtml), $tab_en_edic = this, null != params.$addButton && params.$addButton.click(function() {
        rowAgreg()
    }), null != params.columnsEd && (colsEdi = params.columnsEd.split(","))
};
